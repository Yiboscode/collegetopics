/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css                     *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                *//* empty css               *//* empty css              */import{r as p}from"./request-CfAbx4ue.js";/* empty css                    */import{O as D,r as J,c as N,a as b,n as f,b as o,z as O,w as r,A as P,B as $,C as M,D as F,E as s,o as g,j as d,G,m as c,P as H,u as j,J as K,K as Q,L as W,Q as X,R as Y,N as C}from"./index-BlySnbrc.js";const Z={class:"card",style:{"margin-bottom":"5px"}},ee={class:"card",style:{"margin-bottom":"5px"}},te={class:"card",style:{"margin-bottom":"5px"}},le={key:0,class:"card"},oe={class:"dialog-footer"},xe={__name:"Submit",setup(ae){const k=D(),t=J({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),tableData:[],total:0,pageNum:1,pageSize:5,formVisible:!1,form:{},ids:[],name:null,rules:{userId:[{required:!0,message:"请输入用户%name%name|用户名称",trigger:"blur"}],taskId:[{required:!0,message:"请输入任务%title%title|任务标题",trigger:"blur"}],teacherId:[{required:!0,message:"请输入教师%name%name|教师名称",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],detail:[{required:!0,message:"请输入内容",trigger:"blur"}],time:[{required:!0,message:"请输入时间",trigger:"blur"}],status:[{required:!0,message:"请输入审核状态",trigger:"blur"}],reason:[{required:!0,message:"请输入原因",trigger:"blur"}]},userList:[],taskList:[],teacherList:[],userName:[],taskTitle:[]}),x=l=>{window.open(l)};(()=>{p.get("/user/selectAll").then(l=>{l.code==="200"?t.userList=l.data:s.error(l.msg)})})(),(()=>{p.get("/task/selectAll").then(l=>{l.code==="200"?t.taskList=l.data:s.error(l.msg)})})(),(()=>{p.get("/teacher/selectAll").then(l=>{l.code==="200"?t.teacherList=l.data:s.error(l.msg)})})();const m=()=>{const l={pageNum:t.pageNum,pageSize:t.pageSize,userName:t.userName,taskTitle:t.taskTitle};t.user.role==="TEACHER"&&(l.teacherId=t.user.id),p.get("/submit/selectPage",{params:l}).then(e=>{var u,i;t.tableData=((u=e.data)==null?void 0:u.list)||[],t.total=(i=e.data)==null?void 0:i.total})},E=l=>{t.form=JSON.parse(JSON.stringify(l)),t.formVisible=!0},v=()=>{p.post("/submit/add",t.form).then(l=>{l.code==="200"?(t.formVisible=!1,s.success("操作成功"),m()):s.error(l.msg)})},T=()=>{p.put("/submit/update",t.form).then(l=>{l.code==="200"?(t.formVisible=!1,s.success("操作成功"),m()):s.error(l.msg)})},h=l=>{C.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(e=>{p.delete("/submit/delete/"+l).then(u=>{u.code==="200"?(s.success("删除成功"),m()):s.error(u.msg)})}).catch(e=>{console.error(e)})},S=l=>{t.ids=l.map(e=>e.id)},q=()=>{if(!t.ids.length){s.warning("请选择数据");return}C.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(l=>{p.delete("/submit/delete/batch",{data:t.ids}).then(e=>{e.code==="200"?(s.success("操作成功"),m()):s.error(e.msg)})}).catch(l=>console.log(l))},z=()=>{k.value.validate(l=>{l&&(t.form.id?T():v())})},B=()=>{t.userName=null,t.taskTitle=null,m()};return m(),(l,e)=>{const u=O,i=P,n=G,_=H,I=$,U=M,y=Y,A=X,w=W,L=Q,R=F;return g(),N("div",null,[b("div",Z,[o(u,{modelValue:t.userName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.userName=a),placeholder:"请输入用户查询",style:{width:"240px","margin-right":"10px"}},null,8,["modelValue"]),o(u,{modelValue:t.taskTitle,"onUpdate:modelValue":e[1]||(e[1]=a=>t.taskTitle=a),placeholder:"请输入任务名称查询",style:{width:"240px"}},null,8,["modelValue"]),o(i,{type:"info",plain:"",style:{"margin-left":"10px"},onClick:m},{default:r(()=>e[7]||(e[7]=[d("查询")])),_:1}),o(i,{type:"warning",plain:"",style:{"margin-left":"10px"},onClick:B},{default:r(()=>e[8]||(e[8]=[d("重置")])),_:1})]),b("div",ee,[o(i,{type:"danger",plain:"",onClick:q},{default:r(()=>e[9]||(e[9]=[d("批量删除")])),_:1})]),b("div",te,[o(I,{data:t.tableData,stripe:"",onSelectionChange:S},{default:r(()=>[o(n,{type:"selection",width:"55"}),o(n,{prop:"userName",label:"用户名称"}),o(n,{prop:"taskTitle",label:"任务名称","show-overflow-tooltip":""}),o(n,{prop:"teacherName",label:"教师名称"}),o(n,{prop:"title",label:"成果简介","show-overflow-tooltip":""}),o(n,{prop:"detail",label:"任务成果","show-overflow-tooltip":""},{default:r(a=>[o(i,{type:"primary",onClick:V=>x(a.row.detail),size:"small"},{default:r(()=>e[10]||(e[10]=[d("点击下载")])),_:2},1032,["onClick"])]),_:1}),o(n,{prop:"time",label:"时间","show-overflow-tooltip":""}),o(n,{prop:"status",label:"审核状态"},{default:r(a=>[a.row.status==="待审核"?(g(),c(_,{key:0,type:"warning"},{default:r(()=>e[11]||(e[11]=[d("待审核")])),_:1})):f("",!0),a.row.status==="审核未通过"?(g(),c(_,{key:1,type:"danger"},{default:r(()=>e[12]||(e[12]=[d("审核未通过")])),_:1})):f("",!0),a.row.status==="审核通过"?(g(),c(_,{key:2,type:"success"},{default:r(()=>e[13]||(e[13]=[d("审核通过")])),_:1})):f("",!0)]),_:1}),o(n,{prop:"reason",label:"原因","show-overflow-tooltip":""}),o(n,{label:"操作",width:"80",fixed:"right"},{default:r(a=>[t.user.role==="TEACHER"?(g(),c(i,{key:0,type:"primary",size:"small",onClick:V=>E(a.row),disabled:a.row.status==="审核通过"},{default:r(()=>e[14]||(e[14]=[d("审核")])),_:2},1032,["onClick","disabled"])):f("",!0),t.user.role==="ADMIN"?(g(),c(i,{key:1,type:"danger",circle:"",icon:j(K),onClick:V=>h(a.row.id)},null,8,["icon","onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])]),t.total?(g(),N("div",le,[o(U,{onCurrentChange:m,background:"",layout:"total, prev, pager, next","page-size":t.pageSize,"current-page":t.pageNum,"onUpdate:currentPage":e[2]||(e[2]=a=>t.pageNum=a),total:t.total},null,8,["page-size","current-page","total"])])):f("",!0),o(R,{title:"审核",modelValue:t.formVisible,"onUpdate:modelValue":e[6]||(e[6]=a=>t.formVisible=a),width:"40%","close-on-click-modal":!1,"destroy-on-close":""},{footer:r(()=>[b("span",oe,[o(i,{onClick:e[5]||(e[5]=a=>t.formVisible=!1)},{default:r(()=>e[15]||(e[15]=[d("取消")])),_:1}),o(i,{type:"primary",onClick:z},{default:r(()=>e[16]||(e[16]=[d("保存")])),_:1})])]),default:r(()=>[o(L,{model:t.form,"label-width":"100px",style:{padding:"20px 30px"},ref_key:"formRef",ref:k},{default:r(()=>[o(w,{label:"审核状态",prop:"status"},{default:r(()=>[o(A,{modelValue:t.form.status,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.status=a)},{default:r(()=>[o(y,{label:"审核通过"}),o(y,{label:"审核未通过"})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"处理意见",prop:"reason"},{default:r(()=>[o(u,{type:"textarea",rows:3,modelValue:t.form.reason,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.reason=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{xe as default};
