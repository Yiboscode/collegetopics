/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css            *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                *//* empty css               *//* empty css              */import{r as m}from"./request-CfAbx4ue.js";/* empty css                    */import{O,r as P,c as _,a as f,n as b,b as o,z as R,w as r,A as q,m as y,B as F,C as J,D as H,E as i,o as u,j as c,G as $,u as V,I as M,J as G,K,L as Q,S as W,F as X,x as Y,T as Z,N as h}from"./index-BlySnbrc.js";const ee={class:"card",style:{"margin-bottom":"5px"}},te={class:"card",style:{"margin-bottom":"5px"}},le={class:"card",style:{"margin-bottom":"5px"}},oe={key:0,class:"card"},ae={class:"dialog-footer"},Ce={__name:"Task",setup(re){const k=O(),e=P({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),tableData:[],total:0,pageNum:1,pageSize:5,formVisible:!1,form:{},ids:[],projectTitle:null,rules:{projectId:[{required:!0,message:"请选择项目",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],detail:[{required:!0,message:"请输入内容",trigger:"blur"}]},teacherList:[],projectList:[]});(()=>{m.get("/teacher/selectAll").then(l=>{l.code==="200"?e.teacherList=l.data:i.error(l.msg)})})(),(()=>{m.get("/project/selectAll",{params:{teacherName:e.user.name,status:"审核通过"}}).then(l=>{l.code==="200"?e.projectList=l.data:i.error(l.msg)})})();const d=()=>{const l={pageNum:e.pageNum,pageSize:e.pageSize,projectTitle:e.projectTitle};e.user.role==="TEACHER"&&(l.teacherId=e.user.id),m.get("/task/selectPage",{params:l}).then(t=>{var n,s;e.tableData=((n=t.data)==null?void 0:n.list)||[],e.total=(s=t.data)==null?void 0:s.total})},w=()=>{e.form={},e.formVisible=!0},C=l=>{e.form=JSON.parse(JSON.stringify(l)),e.formVisible=!0},E=()=>{m.post("/task/add",e.form).then(l=>{l.code==="200"?(e.formVisible=!1,i.success("操作成功"),d()):i.error(l.msg)})},v=()=>{m.put("/task/update",e.form).then(l=>{l.code==="200"?(e.formVisible=!1,i.success("操作成功"),d()):i.error(l.msg)})},x=l=>{h.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(t=>{m.delete("/task/delete/"+l).then(n=>{n.code==="200"?(i.success("删除成功"),d()):i.error(n.msg)})}).catch(t=>{console.error(t)})},j=l=>{e.ids=l.map(t=>t.id)},T=()=>{if(!e.ids.length){i.warning("请选择数据");return}h.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(l=>{m.delete("/task/delete/batch",{data:e.ids}).then(t=>{t.code==="200"?(i.success("操作成功"),d()):i.error(t.msg)})}).catch(l=>console.log(l))},N=()=>{k.value.validate(l=>{l&&(e.form.id?v():E())})},S=()=>{e.projectTitle=null,d()};return d(),(l,t)=>{const n=R,s=q,p=$,I=F,B=J,z=Z,A=W,g=Q,L=K,U=H;return u(),_("div",null,[f("div",ee,[o(n,{modelValue:e.projectTitle,"onUpdate:modelValue":t[0]||(t[0]=a=>e.projectTitle=a),placeholder:"请输入项目名称查询",style:{width:"240px"}},null,8,["modelValue"]),o(s,{type:"info",plain:"",style:{"margin-left":"10px"},onClick:d},{default:r(()=>t[7]||(t[7]=[c("查询")])),_:1}),o(s,{type:"warning",plain:"",style:{"margin-left":"10px"},onClick:S},{default:r(()=>t[8]||(t[8]=[c("重置")])),_:1})]),f("div",te,[e.user.role==="TEACHER"?(u(),y(s,{key:0,type:"primary",plain:"",onClick:w},{default:r(()=>t[9]||(t[9]=[c("新增")])),_:1})):b("",!0),o(s,{type:"danger",plain:"",onClick:T},{default:r(()=>t[10]||(t[10]=[c("批量删除")])),_:1})]),f("div",le,[o(I,{data:e.tableData,stripe:"",onSelectionChange:j,"tooltip-effect":"dark dark1"},{default:r(()=>[o(p,{type:"selection",width:"55"}),o(p,{prop:"projectTitle",label:"项目","show-overflow-tooltip":""}),o(p,{prop:"teacherName",label:"教师名称"}),o(p,{prop:"title",label:"任务名称","show-overflow-tooltip":""}),o(p,{prop:"detail",label:"任务内容","show-overflow-tooltip":""}),o(p,{prop:"time",label:"时间","show-overflow-tooltip":""}),o(p,{label:"操作",width:"100",fixed:"right"},{default:r(a=>[e.user.role==="TEACHER"?(u(),y(s,{key:0,type:"primary",circle:"",icon:V(M),onClick:D=>C(a.row)},null,8,["icon","onClick"])):b("",!0),o(s,{type:"danger",circle:"",icon:V(G),onClick:D=>x(a.row.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),e.total?(u(),_("div",oe,[o(B,{onCurrentChange:d,background:"",layout:"total, prev, pager, next","page-size":e.pageSize,"current-page":e.pageNum,"onUpdate:currentPage":t[1]||(t[1]=a=>e.pageNum=a),total:e.total},null,8,["page-size","current-page","total"])])):b("",!0),o(U,{title:"任务信息",modelValue:e.formVisible,"onUpdate:modelValue":t[6]||(t[6]=a=>e.formVisible=a),width:"40%","close-on-click-modal":!1,"destroy-on-close":""},{footer:r(()=>[f("span",ae,[o(s,{onClick:t[5]||(t[5]=a=>e.formVisible=!1)},{default:r(()=>t[11]||(t[11]=[c("取消")])),_:1}),o(s,{type:"primary",onClick:N},{default:r(()=>t[12]||(t[12]=[c("保存")])),_:1})])]),default:r(()=>[o(L,{model:e.form,rules:e.rules,"label-width":"80px",style:{padding:"20px 30px"},ref_key:"formRef",ref:k},{default:r(()=>[o(g,{label:"项目",prop:"projectId"},{default:r(()=>[o(A,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.projectId=a)},{default:r(()=>[(u(!0),_(X,null,Y(e.projectList,a=>(u(),y(z,{key:a.id,value:a.id,label:a.title},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"标题",prop:"title"},{default:r(()=>[o(n,{modelValue:e.form.title,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.title=a),placeholder:"标题"},null,8,["modelValue"])]),_:1}),o(g,{label:"内容",prop:"detail"},{default:r(()=>[o(n,{type:"textarea",rows:4,modelValue:e.form.detail,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.detail=a),placeholder:"内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}};export{Ce as default};
