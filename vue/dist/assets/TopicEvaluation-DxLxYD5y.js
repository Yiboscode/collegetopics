/* empty css                *//* empty css                          *//* empty css               *//* empty css                *//* empty css                  *//* empty css             *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                *//* empty css            *//* empty css               *//* empty css                    *//* empty css              */import{_ as we,O as c,r as K,X as ye,c as M,a as n,b as t,w as l,a3 as Ve,A as Se,B as he,C as Ce,D as Ee,a7 as ke,E as S,o as T,a4 as xe,z as Te,S as De,T as ze,U as Ne,j as u,k as Ue,u as z,a8 as Ie,a9 as Be,aa as Ye,ab as $e,J as qe,t as d,G as Fe,P as Me,K as Re,m as R,n as O,L as Oe,F as Pe,x as Ae,ac as Je,a5 as je,a6 as Le,N as X}from"./index-BlySnbrc.js";/* empty css                    */import{r as E}from"./request-CfAbx4ue.js";const Ge={class:"card",style:{"margin-bottom":"5px"}},Ke={class:"card",style:{"margin-bottom":"5px"}},Xe={style:{"margin-bottom":"10px"}},He={class:"stat-card"},Qe={class:"stat-number"},We={class:"stat-card"},Ze={class:"stat-number"},et={class:"stat-card"},tt={class:"stat-number"},lt={class:"stat-card"},at={class:"stat-number"},ot={class:"score-details"},st={style:{"margin-top":"20px","text-align":"center"}},nt={style:{float:"left"}},ut={style:{float:"right",color:"#8492a6","font-size":"13px"}},it={class:"dialog-footer"},dt={key:0},rt={style:{"white-space":"pre-wrap","line-height":"1.6",margin:"0"}},pt={class:"dialog-footer"},ct={__name:"TopicEvaluation",setup(mt){const P=ke(),m=c([]),N=c(0),U=c(1),I=c(10),f=K({topicTitle:"",evaluatorName:"",status:""}),h=c(null),s=c({}),g=c(!1),B=c(!1),i=c(null),Y=c([]),A=c([]),J=c(null),y=K({total:0,averageScore:0,todayCount:0,weekCount:0}),H={topicId:[{required:!0,message:"请选择选题",trigger:"change"}],innovationScore:[{required:!0,message:"请选择创新性评分",trigger:"change"}],feasibilityScore:[{required:!0,message:"请选择可行性评分",trigger:"change"}],significanceScore:[{required:!0,message:"请选择意义性评分",trigger:"change"}]},V=()=>{const o={pageNum:U.value,pageSize:I.value,...f};h.value&&h.value.length===2&&(o.startDate=h.value[0],o.endDate=h.value[1]),E.get("/topicEvaluation/selectPage",{params:o}).then(e=>{e.code==="200"&&(e.data.list?(m.value=e.data.list,N.value=e.data.total):e.data.records?(m.value=e.data.records,N.value=e.data.total):(m.value=e.data||[],N.value=m.value.length),W())})},Q=()=>{E.get("/topic/selectAll").then(o=>{o.code==="200"&&(A.value=o.data||[])})},W=()=>{if(y.total=m.value.length,m.value.length>0){const v=m.value.reduce((r,w)=>r+parseFloat(w.totalScore||0),0);y.averageScore=(v/m.value.length).toFixed(1)}const o=new Date().toDateString(),e=new Date(Date.now()-7*24*60*60*1e3);y.todayCount=m.value.filter(v=>new Date(v.evaluationTime).toDateString()===o).length,y.weekCount=m.value.filter(v=>new Date(v.evaluationTime)>=e).length},Z=()=>{f.topicTitle="",f.evaluatorName="",f.status="",h.value=null,V()},ee=()=>{s.value={status:"已完成"},g.value=!0},te=o=>{E.get(`/topicEvaluation/myEvaluation/${o}`).then(e=>{e.code==="200"&&e.data?(S.warning("您已经对此选题进行过评价，将为您打开编辑模式"),s.value=JSON.parse(JSON.stringify(e.data)),g.value=!0):(s.value={topicId:parseInt(o),status:"已完成"},g.value=!0)}).catch(()=>{s.value={topicId:parseInt(o),status:"已完成"},g.value=!0})},le=o=>{s.value=JSON.parse(JSON.stringify(o)),g.value=!0},ae=o=>{i.value=o,B.value=!0},oe=o=>{P.push(`/manager/topic?id=${o}`)},se=()=>{window.open("/api/topicEvaluation/export")},ne=()=>{J.value.validate(o=>{if(o){const e=s.value.id?E.put:E.post,v=s.value.id?"/topicEvaluation/update":"/topicEvaluation/add";e(v,s.value).then(r=>{r.code==="200"?(S.success("操作成功"),V(),g.value=!1):S.error(r.msg)})}})},ue=o=>{X.confirm("您确认删除吗？","确认删除",{type:"warning"}).then(()=>{E.delete("/topicEvaluation/"+o).then(e=>{e.code==="200"?(S.success("删除成功"),V()):S.error(e.msg)})}).catch(()=>{})},ie=()=>{if(!Y.value.length){S.warning("请选择数据");return}X.confirm("您确认批量删除这些数据吗？","确认删除",{type:"warning"}).then(()=>{E.delete("/topicEvaluation/del/batch",{data:Y.value}).then(o=>{o.code==="200"?(S.success("删除成功"),V()):S.error(o.msg)})}).catch(()=>{})},de=o=>{Y.value=o.map(e=>e.id)},re=o=>{I.value=o,V()},pe=o=>{U.value=o,V()},ce=()=>{g.value=!1},j=o=>({已完成:"success",待审核:"warning",已审核:"info"})[o]||"info",L=o=>o>=12?"success":o>=9?"warning":"danger",me=()=>{const o=P.currentRoute.value.query.topicId;o&&te(o)};return ye(()=>{V(),Q(),me()}),(o,e)=>{const v=Te,r=xe,w=ze,$=De,ve=Ne,D=Ue,p=Se,q=Ve,_=Fe,C=Me,fe=he,ge=Ce,k=Oe,x=Je,_e=Re,G=Ee,b=Le,be=je;return T(),M("div",null,[n("div",Ge,[t(q,{gutter:20},{default:l(()=>[t(r,{span:5},{default:l(()=>[t(v,{modelValue:f.topicTitle,"onUpdate:modelValue":e[0]||(e[0]=a=>f.topicTitle=a),clearable:"",placeholder:"请输入选题名称",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(r,{span:5},{default:l(()=>[t(v,{modelValue:f.evaluatorName,"onUpdate:modelValue":e[1]||(e[1]=a=>f.evaluatorName=a),clearable:"",placeholder:"请输入评价人姓名",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(r,{span:5},{default:l(()=>[t($,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=a=>f.status=a),clearable:"",placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[t(w,{label:"已完成",value:"已完成"}),t(w,{label:"待审核",value:"待审核"}),t(w,{label:"已审核",value:"已审核"})]),_:1},8,["modelValue"])]),_:1}),t(r,{span:5},{default:l(()=>[t(ve,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(r,{span:4},{default:l(()=>[n("div",null,[t(p,{type:"primary",onClick:V},{default:l(()=>[t(D,null,{default:l(()=>[t(z(Ie))]),_:1}),e[19]||(e[19]=u(" 查询 "))]),_:1}),t(p,{onClick:Z},{default:l(()=>[t(D,null,{default:l(()=>[t(z(Be))]),_:1}),e[20]||(e[20]=u(" 重置 "))]),_:1})])]),_:1})]),_:1})]),n("div",Ke,[n("div",Xe,[t(p,{type:"primary",onClick:ee},{default:l(()=>[t(D,null,{default:l(()=>[t(z(Ye))]),_:1}),e[21]||(e[21]=u(" 新增评价 "))]),_:1}),t(p,{type:"info",onClick:se},{default:l(()=>[t(D,null,{default:l(()=>[t(z($e))]),_:1}),e[22]||(e[22]=u(" 导出 "))]),_:1}),t(p,{type:"danger",onClick:ie,disabled:!Y.value.length},{default:l(()=>[t(D,null,{default:l(()=>[t(z(qe))]),_:1}),e[23]||(e[23]=u(" 批量删除 "))]),_:1},8,["disabled"])]),t(q,{gutter:20,style:{"margin-bottom":"20px"}},{default:l(()=>[t(r,{span:6},{default:l(()=>[n("div",He,[n("div",Qe,d(y.total),1),e[24]||(e[24]=n("div",{class:"stat-label"},"评价总数",-1))])]),_:1}),t(r,{span:6},{default:l(()=>[n("div",We,[n("div",Ze,d(y.averageScore),1),e[25]||(e[25]=n("div",{class:"stat-label"},"平均分",-1))])]),_:1}),t(r,{span:6},{default:l(()=>[n("div",et,[n("div",tt,d(y.todayCount),1),e[26]||(e[26]=n("div",{class:"stat-label"},"今日评价",-1))])]),_:1}),t(r,{span:6},{default:l(()=>[n("div",lt,[n("div",at,d(y.weekCount),1),e[27]||(e[27]=n("div",{class:"stat-label"},"本周评价",-1))])]),_:1})]),_:1}),t(fe,{data:m.value,onSelectionChange:de,"row-key":"id"},{default:l(()=>[t(_,{type:"selection",width:"55",align:"center"}),t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"topicTitle",label:"选题名称","min-width":"200","show-overflow-tooltip":""}),t(_,{prop:"studentName",label:"学生姓名",width:"120"}),t(_,{prop:"evaluatorName",label:"评价人",width:"120"}),t(_,{label:"评分详情",width:"200",align:"center"},{default:l(a=>[n("div",ot,[t(C,{size:"small",class:"score-tag"},{default:l(()=>[u("创新: "+d(a.row.innovationScore)+"/5",1)]),_:2},1024),t(C,{size:"small",class:"score-tag"},{default:l(()=>[u("可行: "+d(a.row.feasibilityScore)+"/5",1)]),_:2},1024),t(C,{size:"small",class:"score-tag"},{default:l(()=>[u("意义: "+d(a.row.significanceScore)+"/5",1)]),_:2},1024)])]),_:1}),t(_,{prop:"totalScore",label:"总分",width:"80",align:"center"},{default:l(a=>[t(C,{type:L(a.row.totalScore),size:"large"},{default:l(()=>[u(d(a.row.totalScore)+"/15 ",1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"status",label:"状态",width:"100"},{default:l(a=>[t(C,{type:j(a.row.status)},{default:l(()=>[u(d(a.row.status),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"evaluationTime",label:"评价时间",width:"180"}),t(_,{label:"操作",width:"280",align:"center",fixed:"right"},{default:l(a=>[t(p,{type:"primary",onClick:F=>ae(a.row),size:"small"},{default:l(()=>e[28]||(e[28]=[u("查看")])),_:2},1032,["onClick"]),t(p,{type:"success",onClick:F=>le(a.row),size:"small"},{default:l(()=>e[29]||(e[29]=[u("编辑")])),_:2},1032,["onClick"]),t(p,{type:"warning",onClick:F=>oe(a.row.topicId),size:"small"},{default:l(()=>e[30]||(e[30]=[u("选题详情")])),_:2},1032,["onClick"]),t(p,{type:"danger",onClick:F=>ue(a.row.id),size:"small"},{default:l(()=>e[31]||(e[31]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n("div",st,[t(ge,{"current-page":U.value,"onUpdate:currentPage":e[4]||(e[4]=a=>U.value=a),"page-size":I.value,"onUpdate:pageSize":e[5]||(e[5]=a=>I.value=a),"page-sizes":[5,10,15,20],small:!1,disabled:!1,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:re,onCurrentChange:pe},null,8,["current-page","page-size","total"])])]),t(G,{modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=a=>g.value=a),title:s.value.id?"编辑评价":"新增评价",width:"60%","before-close":ce},{footer:l(()=>[n("span",it,[t(p,{onClick:e[12]||(e[12]=a=>g.value=!1)},{default:l(()=>e[32]||(e[32]=[u("取消")])),_:1}),t(p,{type:"primary",onClick:ne},{default:l(()=>e[33]||(e[33]=[u("确定")])),_:1})])]),default:l(()=>[t(_e,{model:s.value,rules:H,ref_key:"formRef",ref:J,"label-width":"100px"},{default:l(()=>[s.value.id?O("",!0):(T(),R(k,{key:0,label:"选择选题",prop:"topicId"},{default:l(()=>[t($,{modelValue:s.value.topicId,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.topicId=a),placeholder:"请选择选题",style:{width:"100%"},filterable:""},{default:l(()=>[(T(!0),M(Pe,null,Ae(A.value,a=>(T(),R(w,{key:a.id,label:a.title,value:a.id},{default:l(()=>[n("span",nt,d(a.title),1),n("span",ut,d(a.studentName),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),t(q,{gutter:20},{default:l(()=>[t(r,{span:8},{default:l(()=>[t(k,{label:"创新性评分",prop:"innovationScore"},{default:l(()=>[t(x,{modelValue:s.value.innovationScore,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.innovationScore=a),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{span:8},{default:l(()=>[t(k,{label:"可行性评分",prop:"feasibilityScore"},{default:l(()=>[t(x,{modelValue:s.value.feasibilityScore,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.feasibilityScore=a),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{span:8},{default:l(()=>[t(k,{label:"意义性评分",prop:"significanceScore"},{default:l(()=>[t(x,{modelValue:s.value.significanceScore,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.significanceScore=a),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(k,{label:"评价建议",prop:"suggestions"},{default:l(()=>[t(v,{modelValue:s.value.suggestions,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.suggestions=a),type:"textarea",rows:4,placeholder:"请输入评价建议..."},null,8,["modelValue"])]),_:1}),t(k,{label:"状态",prop:"status"},{default:l(()=>[t($,{modelValue:s.value.status,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[t(w,{label:"已完成",value:"已完成"}),t(w,{label:"待审核",value:"待审核"}),t(w,{label:"已审核",value:"已审核"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(G,{modelValue:B.value,"onUpdate:modelValue":e[18]||(e[18]=a=>B.value=a),title:"评价详情",width:"70%"},{footer:l(()=>[n("span",pt,[t(p,{onClick:e[17]||(e[17]=a=>B.value=!1)},{default:l(()=>e[34]||(e[34]=[u("关闭")])),_:1})])]),default:l(()=>[i.value?(T(),M("div",dt,[t(be,{column:2,border:""},{default:l(()=>[t(b,{label:"选题名称",span:2},{default:l(()=>[u(d(i.value.topicTitle),1)]),_:1}),t(b,{label:"学生姓名"},{default:l(()=>[u(d(i.value.studentName),1)]),_:1}),t(b,{label:"评价人"},{default:l(()=>[u(d(i.value.evaluatorName),1)]),_:1}),t(b,{label:"评价时间",span:2},{default:l(()=>[u(d(i.value.evaluationTime),1)]),_:1}),t(b,{label:"创新性评分"},{default:l(()=>[t(x,{modelValue:i.value.innovationScore,"onUpdate:modelValue":e[14]||(e[14]=a=>i.value.innovationScore=a),disabled:"","show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1}),t(b,{label:"可行性评分"},{default:l(()=>[t(x,{modelValue:i.value.feasibilityScore,"onUpdate:modelValue":e[15]||(e[15]=a=>i.value.feasibilityScore=a),disabled:"","show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1}),t(b,{label:"意义性评分"},{default:l(()=>[t(x,{modelValue:i.value.significanceScore,"onUpdate:modelValue":e[16]||(e[16]=a=>i.value.significanceScore=a),disabled:"","show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1}),t(b,{label:"总分"},{default:l(()=>[t(C,{type:L(i.value.totalScore),size:"large"},{default:l(()=>[u(d(i.value.totalScore)+"/15 ",1)]),_:1},8,["type"])]),_:1}),t(b,{label:"状态",span:2},{default:l(()=>[t(C,{type:j(i.value.status)},{default:l(()=>[u(d(i.value.status),1)]),_:1},8,["type"])]),_:1}),i.value.suggestions?(T(),R(b,{key:0,label:"评价建议",span:2},{default:l(()=>[n("p",rt,d(i.value.suggestions),1)]),_:1})):O("",!0)]),_:1})])):O("",!0)]),_:1},8,["modelValue"])])}}},It=we(ct,[["__scopeId","data-v-c728765c"]]);export{It as default};
