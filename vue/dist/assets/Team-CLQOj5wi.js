/* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                  *//* empty css            *//* empty css               *//* empty css                  *//* empty css              *//* empty css             *//* empty css               */import{r as y}from"./request-CfAbx4ue.js";/* empty css                    */import{_ as E,c as p,a as s,b as i,m as g,w as o,ad as R,ap as S,z as B,F as w,x as v,D as L,E as h,N as U,o as r,t as n,A as q,j as m,n as _,P as z,av as P,aA as K,K as O,L as J,S as G,T as H,af as Q,aB as W}from"./index-BlySnbrc.js";const X={name:"Team",data(){return{myTeam:null,teamList:[],myApplications:[],searchForm:{teamName:""},showCreateDialog:!1,createForm:{topicId:"",teamName:""},createRules:{topicId:[{required:!0,message:"请选择选题",trigger:"change"}],teamName:[{required:!0,message:"请输入团队名称",trigger:"blur"}]},showApplyFormDialog:!1,applyForm:{teamId:"",message:""},showDetailDialog:!1,selectedTeam:null,teamMembers:[],showApplicationsDialog:!1,teamApplications:[],pendingCount:0,showRejectFormDialog:!1,rejectForm:{applicationId:"",reason:""},myTopics:[]}},mounted(){this.loadData()},methods:{async loadData(){await this.loadMyTeam(),await this.loadTeamList(),await this.loadMyApplications(),this.myTeam&&await this.loadPendingApplicationCount()},async loadMyTeam(){try{const l=await y.get("/team/myTeam");this.myTeam=l.data}catch(l){console.error("加载我的团队失败:",l)}},async loadTeamList(){try{const l=await y.get("/team/selectAll",{params:{teamName:this.searchForm.teamName}});this.teamList=l.data||[]}catch(l){console.error("加载团队列表失败:",l)}},async loadMyApplications(){try{const l=await y.get("/teamApplication/myApplications");this.myApplications=l.data||[]}catch(l){console.error("加载我的申请失败:",l)}},async loadMyTopics(){var l;try{const e=await y.get("/topic/selectAll"),A=JSON.parse(localStorage.getItem("xm-user")||"{}");this.myTopics=((l=e.data)==null?void 0:l.filter(F=>F.studentId===A.id&&F.status==="审核通过"))||[]}catch(e){console.error("加载我的选题失败:",e)}},async createTeam(){this.$refs.createFormRef.validate(async l=>{if(l)try{await y.post("/team/add",this.createForm),h.success("创建团队成功！"),this.showCreateDialog=!1,this.createForm={topicId:"",teamName:""},await this.loadData()}catch(e){h.error(e.message||"创建团队失败")}})},showApplyDialogMethod(l){this.selectedTeam=l,this.applyForm={teamId:l.id,message:""},this.showApplyFormDialog=!0},async submitApplication(){try{await y.post("/teamApplication/apply",this.applyForm),h.success("申请提交成功！"),this.showApplyFormDialog=!1,this.applyForm={teamId:"",message:""},await this.loadMyApplications()}catch(l){h.error(l.message||"申请失败")}},async showTeamDetail(l){this.selectedTeam=l,await this.loadTeamMembers(l.id),this.showDetailDialog=!0},async loadTeamMembers(l){try{const e=await y.get(`/teamMember/selectByTeamId/${l}`);this.teamMembers=e.data||[]}catch(e){console.error("加载团队成员失败:",e)}},async manageApplications(){await this.loadTeamApplications(),this.showApplicationsDialog=!0},async loadTeamApplications(){try{const l=await y.get(`/teamApplication/selectByTeamId/${this.selectedTeam.id}`);this.teamApplications=l.data||[]}catch(l){console.error("加载团队申请失败:",l)}},async loadPendingApplicationCount(){try{const l=await y.get(`/teamApplication/getPendingApplicationCount/${this.myTeam.id}`);this.pendingCount=l.data||0}catch(l){console.error("加载待处理申请数量失败:",l)}},async handleApplication(l,e){try{await y.post("/teamApplication/handle",null,{params:{applicationId:l,status:e}}),h.success(e==="approved"?"已同意申请":"已拒绝申请"),await this.loadTeamApplications(),await this.loadTeamMembers(this.selectedTeam.id),await this.loadPendingApplicationCount()}catch(A){h.error(A.message||"操作失败")}},showRejectDialogMethod(l){this.rejectForm.applicationId=l.id,this.rejectForm.reason="",this.showRejectFormDialog=!0},async rejectApplication(){try{await y.post("/teamApplication/handle",null,{params:{applicationId:this.rejectForm.applicationId,status:"rejected",rejectReason:this.rejectForm.reason}}),h.success("已拒绝申请"),this.showRejectFormDialog=!1,await this.loadTeamApplications(),await this.loadPendingApplicationCount()}catch(l){h.error(l.message||"操作失败")}},async quitTeam(){try{await U.confirm("确定要退出团队吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.post(`/team/quit/${this.selectedTeam.id}`),h.success("已退出团队"),this.showDetailDialog=!1,await this.loadData()}catch(l){l!=="cancel"&&h.error(l.message||"退出团队失败")}},isMyTeam(l){return this.myTeam&&this.myTeam.id===l.id},isTeamLeader(l){const e=JSON.parse(localStorage.getItem("xm-user")||"{}");return this.myTeam&&this.myTeam.leaderId===e.id},getStatusType(l){return{pending:"warning",approved:"success",rejected:"danger"}[l]||"info"},getStatusText(l){return{pending:"待审核",approved:"已同意",rejected:"已拒绝"}[l]||l},showAllApplications(){h.info("功能开发中...")}},watch:{showCreateDialog(l){l&&this.loadMyTopics()}}},Y={class:"team-container"},Z={class:"function-cards"},$={class:"card-header"},ee={class:"team-info"},te={class:"team-name"},se={class:"team-topic"},ae={class:"team-stats"},le={class:"create-team-content"},oe={class:"card-header"},ie={class:"application-list"},re={key:0,class:"empty-state"},ne={key:1},me={class:"app-info"},de={class:"team-name"},pe={class:"app-time"},ce={class:"team-list-section"},ue={class:"section-header"},ye={class:"search-bar"},he={class:"team-grid"},ge={class:"team-header"},_e={class:"team-topic"},fe={class:"team-footer"},Te={class:"team-leader"},we={class:"team-count"},ve={key:0,class:"apply-btn"},Ae={class:"apply-team-info"},Ce={key:0,class:"team-detail"},ke={class:"detail-header"},De={class:"detail-content"},Fe={class:"detail-item"},be={class:"detail-item"},Ve={class:"detail-item"},Ne={class:"detail-item"},Me={class:"members-section"},xe={class:"members-list"},je={class:"member-info"},Ie={class:"member-name"},Ee={class:"member-role"},Re={key:0,class:"detail-actions"},Se={class:"applications-list"},Be={key:0,class:"empty-state"},Le={key:1},Ue={class:"applicant-info"},qe={class:"applicant-details"},ze={class:"apply-time"},Pe={class:"apply-message"},Ke={key:0,class:"application-actions"},Oe={key:1,class:"application-status"};function Je(l,e,A,F,a,d){const c=q,C=R,f=z,k=B,M=H,x=G,D=J,b=O,T=L,V=Q,j=W;return r(),p("div",Y,[e[42]||(e[42]=s("div",{class:"header"},[s("h2",null,"团队管理"),s("p",null,"发现优秀团队，组建你的创业伙伴")],-1)),s("div",Z,[a.myTeam?(r(),g(C,{key:0,class:"team-card my-team-card"},{header:o(()=>[s("div",$,[e[16]||(e[16]=s("span",null,"我的团队",-1)),i(c,{type:"primary",size:"small",onClick:e[0]||(e[0]=t=>d.showTeamDetail(a.myTeam))},{default:o(()=>e[15]||(e[15]=[m("查看详情")])),_:1})])]),default:o(()=>[s("div",ee,[s("div",te,n(a.myTeam.teamName),1),s("div",se,"选题："+n(a.myTeam.topicTitle),1),s("div",ae,[s("span",null,"队长："+n(a.myTeam.leaderName),1),s("span",null,"成员："+n(a.myTeam.memberCount||0)+"/7",1)])])]),_:1})):(r(),g(C,{key:1,class:"team-card create-team-card"},{header:o(()=>e[17]||(e[17]=[s("div",{class:"card-header"},[s("span",null,"创建团队")],-1)])),default:o(()=>[s("div",le,[e[19]||(e[19]=s("p",null,"还没有团队？立即创建属于你的团队吧！",-1)),i(c,{type:"primary",onClick:e[1]||(e[1]=t=>a.showCreateDialog=!0)},{default:o(()=>e[18]||(e[18]=[m("创建团队")])),_:1})])]),_:1})),i(C,{class:"team-card"},{header:o(()=>[s("div",oe,[e[21]||(e[21]=s("span",null,"我的申请",-1)),i(c,{type:"link",onClick:d.loadMyApplications},{default:o(()=>e[20]||(e[20]=[m("刷新")])),_:1},8,["onClick"])])]),default:o(()=>[s("div",ie,[a.myApplications.length===0?(r(),p("div",re," 暂无申请记录 ")):(r(),p("div",ne,[(r(!0),p(w,null,v(a.myApplications.slice(0,3),t=>(r(),p("div",{key:t.id,class:"application-item"},[s("div",me,[s("span",de,n(t.teamName),1),i(f,{type:d.getStatusType(t.status)},{default:o(()=>[m(n(d.getStatusText(t.status)),1)]),_:2},1032,["type"])]),s("div",pe,n(t.applyTime),1)]))),128)),a.myApplications.length>3?(r(),g(c,{key:0,type:"link",onClick:d.showAllApplications},{default:o(()=>e[22]||(e[22]=[m("查看全部")])),_:1},8,["onClick"])):_("",!0)]))])]),_:1})]),s("div",ce,[s("div",ue,[e[23]||(e[23]=s("h3",null,"发现团队",-1)),s("div",ye,[i(k,{modelValue:a.searchForm.teamName,"onUpdate:modelValue":e[2]||(e[2]=t=>a.searchForm.teamName=t),placeholder:"搜索团队名称",onKeyup:S(d.loadTeamList,["enter"]),style:{width:"300px"}},{append:o(()=>[i(c,{onClick:d.loadTeamList,icon:"Search"},null,8,["onClick"])]),_:1},8,["modelValue","onKeyup"])])]),s("div",he,[(r(!0),p(w,null,v(a.teamList,t=>(r(),g(C,{key:t.id,class:K(["team-item-card",{"full-team":t.memberCount>=7}]),onClick:u=>d.showTeamDetail(t)},{default:o(()=>[s("div",ge,[s("h4",null,n(t.teamName),1),t.memberCount>=7?(r(),g(f,{key:0,type:"info"},{default:o(()=>e[24]||(e[24]=[m("已满员")])),_:1})):(r(),g(f,{key:1,type:"success"},{default:o(()=>e[25]||(e[25]=[m("招募中")])),_:1}))]),s("div",_e,n(t.topicTitle),1),s("div",fe,[s("div",Te,"队长："+n(t.leaderName),1),s("div",we,n(t.memberCount||0)+"/7人",1)]),!a.myTeam&&t.memberCount<7?(r(),p("div",ve,[i(c,{type:"primary",size:"small",onClick:P(u=>d.showApplyDialogMethod(t),["stop"])},{default:o(()=>e[26]||(e[26]=[m(" 申请加入 ")])),_:2},1032,["onClick"])])):_("",!0)]),_:2},1032,["class","onClick"]))),128))])]),i(T,{modelValue:a.showCreateDialog,"onUpdate:modelValue":e[6]||(e[6]=t=>a.showCreateDialog=t),title:"创建团队",width:"600px"},{footer:o(()=>[i(c,{onClick:e[5]||(e[5]=t=>a.showCreateDialog=!1)},{default:o(()=>e[27]||(e[27]=[m("取消")])),_:1}),i(c,{type:"primary",onClick:d.createTeam},{default:o(()=>e[28]||(e[28]=[m("创建")])),_:1},8,["onClick"])]),default:o(()=>[i(b,{model:a.createForm,rules:a.createRules,ref:"createFormRef","label-width":"80px"},{default:o(()=>[i(D,{label:"选题",prop:"topicId"},{default:o(()=>[i(x,{modelValue:a.createForm.topicId,"onUpdate:modelValue":e[3]||(e[3]=t=>a.createForm.topicId=t),placeholder:"请选择选题",style:{width:"100%"}},{default:o(()=>[(r(!0),p(w,null,v(a.myTopics,t=>(r(),g(M,{key:t.id,label:t.title,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(D,{label:"团队名称",prop:"teamName"},{default:o(()=>[i(k,{modelValue:a.createForm.teamName,"onUpdate:modelValue":e[4]||(e[4]=t=>a.createForm.teamName=t),placeholder:"请输入团队名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),i(T,{modelValue:a.showApplyFormDialog,"onUpdate:modelValue":e[9]||(e[9]=t=>a.showApplyFormDialog=t),title:"申请加入团队",width:"500px"},{footer:o(()=>[i(c,{onClick:e[8]||(e[8]=t=>a.showApplyFormDialog=!1)},{default:o(()=>e[29]||(e[29]=[m("取消")])),_:1}),i(c,{type:"primary",onClick:d.submitApplication},{default:o(()=>e[30]||(e[30]=[m("提交申请")])),_:1},8,["onClick"])]),default:o(()=>{var t,u,N;return[s("div",Ae,[s("h4",null,n((t=a.selectedTeam)==null?void 0:t.teamName),1),s("p",null,"选题："+n((u=a.selectedTeam)==null?void 0:u.topicTitle),1),s("p",null,"队长："+n((N=a.selectedTeam)==null?void 0:N.leaderName),1)]),i(b,{model:a.applyForm,ref:"applyFormRef","label-width":"80px"},{default:o(()=>[i(D,{label:"申请留言",prop:"message"},{default:o(()=>[i(k,{modelValue:a.applyForm.message,"onUpdate:modelValue":e[7]||(e[7]=I=>a.applyForm.message=I),type:"textarea",rows:4,placeholder:"请简单介绍一下自己，说明为什么要加入这个团队..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]}),_:1},8,["modelValue"]),i(T,{modelValue:a.showDetailDialog,"onUpdate:modelValue":e[10]||(e[10]=t=>a.showDetailDialog=t),title:"团队详情",width:"700px"},{default:o(()=>[a.selectedTeam?(r(),p("div",Ce,[s("div",ke,[s("h3",null,n(a.selectedTeam.teamName),1),i(f,{type:a.selectedTeam.memberCount>=7?"info":"success"},{default:o(()=>[m(n(a.selectedTeam.memberCount>=7?"已满员":"招募中"),1)]),_:1},8,["type"])]),s("div",De,[s("div",Fe,[e[31]||(e[31]=s("label",null,"选题：",-1)),s("span",null,n(a.selectedTeam.topicTitle),1)]),s("div",be,[e[32]||(e[32]=s("label",null,"队长：",-1)),s("span",null,n(a.selectedTeam.leaderName),1)]),s("div",Ve,[e[33]||(e[33]=s("label",null,"成员数量：",-1)),s("span",null,n(a.selectedTeam.memberCount||0)+"/7人",1)]),s("div",Ne,[e[34]||(e[34]=s("label",null,"创建时间：",-1)),s("span",null,n(a.selectedTeam.createTime),1)])]),s("div",Me,[e[35]||(e[35]=s("h4",null,"团队成员",-1)),s("div",xe,[(r(!0),p(w,null,v(a.teamMembers,t=>(r(),p("div",{key:t.id,class:"member-item"},[i(V,{src:t.avatar,size:40},{default:o(()=>{var u;return[m(n((u=t.studentName)==null?void 0:u.charAt(0)),1)]}),_:2},1032,["src"]),s("div",je,[s("div",Ie,n(t.studentName),1),s("div",Ee,n(t.role),1)])]))),128))])]),d.isMyTeam(a.selectedTeam)?(r(),p("div",Re,[d.isTeamLeader(a.selectedTeam)?(r(),g(c,{key:0,type:"primary",onClick:d.manageApplications},{default:o(()=>[e[36]||(e[36]=m(" 管理申请 ")),a.pendingCount>0?(r(),g(j,{key:0,value:a.pendingCount},null,8,["value"])):_("",!0)]),_:1},8,["onClick"])):_("",!0),d.isTeamLeader(a.selectedTeam)?_("",!0):(r(),g(c,{key:1,type:"danger",onClick:d.quitTeam},{default:o(()=>e[37]||(e[37]=[m("退出团队")])),_:1},8,["onClick"]))])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),i(T,{modelValue:a.showApplicationsDialog,"onUpdate:modelValue":e[11]||(e[11]=t=>a.showApplicationsDialog=t),title:"申请管理",width:"800px"},{default:o(()=>[s("div",Se,[a.teamApplications.length===0?(r(),p("div",Be," 暂无待处理申请 ")):(r(),p("div",Le,[(r(!0),p(w,null,v(a.teamApplications,t=>(r(),p("div",{key:t.id,class:"application-card"},[s("div",Ue,[i(V,{src:t.avatar,size:50},{default:o(()=>{var u;return[m(n((u=t.applicantName)==null?void 0:u.charAt(0)),1)]}),_:2},1032,["src"]),s("div",qe,[s("h4",null,n(t.applicantName),1),s("p",ze,"申请时间："+n(t.applyTime),1),s("p",Pe,n(t.message||"该用户没有留言"),1)])]),t.status==="pending"?(r(),p("div",Ke,[i(c,{type:"success",onClick:u=>d.handleApplication(t.id,"approved")},{default:o(()=>e[38]||(e[38]=[m("同意")])),_:2},1032,["onClick"]),i(c,{type:"danger",onClick:u=>d.showRejectDialogMethod(t)},{default:o(()=>e[39]||(e[39]=[m("拒绝")])),_:2},1032,["onClick"])])):(r(),p("div",Oe,[i(f,{type:d.getStatusType(t.status)},{default:o(()=>[m(n(d.getStatusText(t.status)),1)]),_:2},1032,["type"])]))]))),128))]))])]),_:1},8,["modelValue"]),i(T,{modelValue:a.showRejectFormDialog,"onUpdate:modelValue":e[14]||(e[14]=t=>a.showRejectFormDialog=t),title:"拒绝申请",width:"400px"},{footer:o(()=>[i(c,{onClick:e[13]||(e[13]=t=>a.showRejectFormDialog=!1)},{default:o(()=>e[40]||(e[40]=[m("取消")])),_:1}),i(c,{type:"danger",onClick:d.rejectApplication},{default:o(()=>e[41]||(e[41]=[m("确认拒绝")])),_:1},8,["onClick"])]),default:o(()=>[i(b,{model:a.rejectForm,ref:"rejectFormRef"},{default:o(()=>[i(D,{label:"拒绝原因"},{default:o(()=>[i(k,{modelValue:a.rejectForm.reason,"onUpdate:modelValue":e[12]||(e[12]=t=>a.rejectForm.reason=t),type:"textarea",rows:3,placeholder:"请输入拒绝原因..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const it=E(X,[["render",Je],["__scopeId","data-v-403018f3"]]);export{it as default};
