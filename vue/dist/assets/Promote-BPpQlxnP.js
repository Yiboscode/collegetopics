/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css               *//* empty css                 *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                     *//* empty css               *//* empty css              */import{r as u}from"./request-CfAbx4ue.js";/* empty css                    */import{O as $,r as A,c as b,a as c,n as y,b as o,z as F,w as a,A as R,B as j,C as G,D as H,o as f,j as p,G as K,m as L,H as Q,u as g,I as W,J as X,K as Y,L as Z,M as ee,N as k,E as s}from"./index-BlySnbrc.js";const te={class:"card",style:{"margin-bottom":"5px"}},oe={class:"card",style:{"margin-bottom":"5px"}},le={class:"card",style:{"margin-bottom":"5px"}},ae=["src"],re={key:0,class:"card"},ie={class:"dialog-footer"},Ee={__name:"Promote",setup(se){const w="/api",v=$(),e=A({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),tableData:[],total:0,pageNum:1,pageSize:5,formVisible:!1,form:{},ids:[],title:null,rules:{img:[{required:!0,message:"请输入图片",trigger:"blur"}],video:[{required:!0,message:"请输入视频",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}]}}),x=l=>{e.form.img=l.data},V=l=>{e.form.video=l.data},n=()=>{u.get("/promote/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,title:e.title}}).then(l=>{var t,d;e.tableData=((t=l.data)==null?void 0:t.list)||[],e.total=(d=l.data)==null?void 0:d.total})},C=()=>{e.form={},e.formVisible=!0},E=l=>{e.form=JSON.parse(JSON.stringify(l)),e.formVisible=!0},N=()=>{u.post("/promote/add",e.form).then(l=>{l.code==="200"?(e.formVisible=!1,s.success("操作成功"),n()):s.error(l.msg)})},S=()=>{u.put("/promote/update",e.form).then(l=>{l.code==="200"?(e.formVisible=!1,s.success("操作成功"),n()):s.error(l.msg)})},B=l=>{k.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(t=>{u.delete("/promote/delete/"+l).then(d=>{d.code==="200"?(s.success("删除成功"),n()):s.error(d.msg)})}).catch(t=>{console.error(t)})},z=l=>{e.ids=l.map(t=>t.id)},I=()=>{if(!e.ids.length){s.warning("请选择数据");return}k.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(l=>{u.delete("/promote/delete/batch",{data:e.ids}).then(t=>{t.code==="200"?(s.success("操作成功"),n()):s.error(t.msg)})}).catch(l=>console.log(l))},U=()=>{v.value.validate(l=>{l&&(e.form.id?S():N())})},D=()=>{e.title=null,n()};return n(),(l,t)=>{const d=F,i=R,m=K,q=Q,J=j,O=G,h=ee,_=Z,P=Y,M=H;return f(),b("div",null,[c("div",te,[o(d,{modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=r=>e.title=r),placeholder:"请输入名称查询",style:{width:"240px"}},null,8,["modelValue"]),o(i,{type:"info",plain:"",style:{"margin-left":"10px"},onClick:n},{default:a(()=>t[5]||(t[5]=[p("查询")])),_:1}),o(i,{type:"warning",plain:"",style:{"margin-left":"10px"},onClick:D},{default:a(()=>t[6]||(t[6]=[p("重置")])),_:1})]),c("div",oe,[o(i,{type:"primary",plain:"",onClick:C},{default:a(()=>t[7]||(t[7]=[p("新增")])),_:1}),o(i,{type:"danger",plain:"",onClick:I},{default:a(()=>t[8]||(t[8]=[p("批量删除")])),_:1})]),c("div",le,[o(J,{data:e.tableData,stripe:"",onSelectionChange:z},{default:a(()=>[o(m,{type:"selection",width:"55"}),o(m,{prop:"title",label:"名称","show-overflow-tooltip":""}),o(m,{label:"图片"},{default:a(r=>[r.row.img?(f(),L(q,{key:0,style:{width:"150px",height:"100px","border-radius":"5px"},src:r.row.img,"preview-src-list":[r.row.img],"preview-teleported":""},null,8,["src","preview-src-list"])):y("",!0)]),_:1}),o(m,{label:"视频",width:"300"},{default:a(r=>[r.row.video?(f(),b("video",{key:0,src:r.row.video,controls:"",style:{width:"150px",height:"100px"}},null,8,ae)):y("",!0)]),_:1}),o(m,{prop:"time",label:"时间","show-overflow-tooltip":""}),o(m,{prop:"views",label:"浏览量"}),o(m,{label:"操作",width:"100",fixed:"right"},{default:a(r=>[o(i,{type:"primary",circle:"",icon:g(W),onClick:T=>E(r.row)},null,8,["icon","onClick"]),o(i,{type:"danger",circle:"",icon:g(X),onClick:T=>B(r.row.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),e.total?(f(),b("div",re,[o(O,{onCurrentChange:n,background:"",layout:"total, prev, pager, next","page-size":e.pageSize,"current-page":e.pageNum,"onUpdate:currentPage":t[1]||(t[1]=r=>e.pageNum=r),total:e.total},null,8,["page-size","current-page","total"])])):y("",!0),o(M,{title:"宣传视频信息",modelValue:e.formVisible,"onUpdate:modelValue":t[4]||(t[4]=r=>e.formVisible=r),width:"40%","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[c("span",ie,[o(i,{onClick:t[3]||(t[3]=r=>e.formVisible=!1)},{default:a(()=>t[11]||(t[11]=[p("取消")])),_:1}),o(i,{type:"primary",onClick:U},{default:a(()=>t[12]||(t[12]=[p("保存")])),_:1})])]),default:a(()=>[o(P,{model:e.form,rules:e.rules,"label-width":"80px",style:{padding:"20px 30px"},ref_key:"formRef",ref:v},{default:a(()=>[o(_,{label:"图片",prop:"img"},{default:a(()=>[o(h,{action:g(w)+"/files/upload",headers:{token:e.user.token},"list-type":"picture","on-success":x},{default:a(()=>[o(i,{type:"primary"},{default:a(()=>t[9]||(t[9]=[p("上传")])),_:1})]),_:1},8,["action","headers"])]),_:1}),o(_,{label:"视频",prop:"video"},{default:a(()=>[o(h,{action:g(w)+"/files/upload",headers:{token:e.user.token},"on-success":V},{default:a(()=>[o(i,{type:"primary"},{default:a(()=>t[10]||(t[10]=[p("上传")])),_:1})]),_:1},8,["action","headers"])]),_:1}),o(_,{label:"标题",prop:"title"},{default:a(()=>[o(d,{modelValue:e.form.title,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.title=r),placeholder:"标题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}};export{Ee as default};
