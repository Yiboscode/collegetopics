/* empty css                *//* empty css               *//* empty css                *//* empty css                  *//* empty css              *//* empty css             *//* empty css              *//* empty css                      *//* empty css             *//* empty css            *//* empty css                          *//* empty css            *//* empty css               */import{_ as B,I as N,aw as A,c as m,n as _,a as i,b as o,m as b,w as t,A as z,ad as U,D as q,o as c,j as u,a3 as L,a4 as P,a5 as j,a6 as H,P as J,t as n,v as K,F as V,x as F,y as O,ai as G,K as M,L as Q,ac as W,z as X}from"./index-BlySnbrc.js";import{r as f}from"./request-CfAbx4ue.js";const Y={name:"TopicDetail",components:{ArrowLeft:A,Edit:N},data(){return{topic:null,evaluations:[],recommendTopics:[],averageScore:0,evaluationVisible:!1,loading:!1,canEvaluate:!1,evaluationForm:{innovationScore:0,feasibilityScore:0,significanceScore:0,suggestions:""},evaluationRules:{innovationScore:[{required:!0,message:"请选择创新性评分",trigger:"change"}],feasibilityScore:[{required:!0,message:"请选择可行性评分",trigger:"change"}],significanceScore:[{required:!0,message:"请选择意义性评分",trigger:"change"}]}}},created(){this.loadTopicDetail()},methods:{loadTopicDetail(){const a=this.$route.params.id;if(!a){this.$message.error("选题ID无效"),this.goBack();return}f.get(`/topic/selectById/${a}`).then(e=>{e.code==="200"?(this.topic=e.data,this.loadEvaluations(),this.loadRecommendations(),this.checkCanEvaluate()):(this.$message.error(e.msg||"加载选题详情失败"),this.goBack())}).catch(()=>{this.$message.error("加载选题详情失败"),this.goBack()})},loadEvaluations(){f.get("/topicEvaluation/selectPage",{params:{topicId:this.topic.id,pageNum:1,pageSize:100}}).then(a=>{a.code==="200"&&(this.evaluations=a.data.list||[],this.calculateAverageScore())})},loadRecommendations(){f.get("/topic/selectPage",{params:{category:this.topic.category,pageNum:1,pageSize:3}}).then(a=>{a.code==="200"&&(this.recommendTopics=(a.data.list||[]).filter(e=>e.id!==this.topic.id))})},checkCanEvaluate(){JSON.parse(localStorage.getItem("xm-user")||"{}").role==="TEACHER"&&f.get(`/topicEvaluation/myEvaluation/${this.topic.id}`).then(e=>{e.code==="200"&&e.data?(this.canEvaluate=!1,this.$message.info("您已经对此选题进行过评价")):this.canEvaluate=!0}).catch(()=>{this.canEvaluate=!0})},calculateAverageScore(){if(this.evaluations.length===0){this.averageScore=0;return}const a=this.evaluations.reduce((e,k)=>e+k.totalScore,0);this.averageScore=(a/this.evaluations.length).toFixed(1)},getStatusType(a){return{待评价:"warning",评价中:"primary",审核中:"info",审核通过:"success",审核不通过:"danger"}[a]||"info"},showEvaluationDialog(){this.evaluationVisible=!0},handleEvaluationClose(){this.evaluationVisible=!1,this.resetEvaluationForm()},resetEvaluationForm(){var a;this.evaluationForm={innovationScore:0,feasibilityScore:0,significanceScore:0,suggestions:""},(a=this.$refs.evaluationFormRef)==null||a.clearValidate()},submitEvaluation(){this.$refs.evaluationFormRef.validate(a=>{if(a){this.loading=!0;const e={...this.evaluationForm,topicId:this.topic.id};f.post("/topicEvaluation/add",e).then(()=>{this.$message.success("评价提交成功"),this.evaluationVisible=!1,this.resetEvaluationForm(),this.loadEvaluations(),this.canEvaluate=!1}).finally(()=>{this.loading=!1})}})},viewRecommend(a){this.$router.push(`/front/topicDetail/${a.id}`)},goBack(){this.$router.go(-1)}}},Z={key:0,class:"topic-detail"},$={class:"back-section"},ee={class:"card-header"},te={class:"topic-title"},oe={class:"topic-status"},se={class:"description-text"},ie={class:"description-text"},le={class:"description-text"},ae={class:"description-text"},ne={class:"description-text"},re={class:"evaluation-section"},ce={key:0,class:"score-display"},ue={class:"score-circle"},de={class:"score-number"},pe={key:1,class:"evaluations-list"},me={class:"evaluation-item"},_e={class:"evaluator-info"},fe={class:"scores"},ge={class:"score-item"},ve={class:"score-value"},he={class:"score-item"},ye={class:"score-value"},be={class:"score-item"},Ee={class:"score-value"},Se={class:"total-score"},ke={key:0,class:"comments"},Ve={key:0,class:"action-section"},Fe={class:"recommend-title"},we={class:"recommend-info"},Ce={class:"dialog-footer"};function xe(a,e,k,Ie,s,p){const g=z,E=J,r=H,w=j,d=P,v=L,h=U,C=O,x=K,I=G,S=W,y=Q,T=X,D=M,R=q;return s.topic?(c(),m("div",Z,[i("div",$,[o(g,{onClick:p.goBack,icon:a.ArrowLeft,type:"primary",plain:""},{default:t(()=>e[6]||(e[6]=[u(" 返回选题列表 ")])),_:1},8,["onClick","icon"])]),o(h,{class:"topic-card"},{header:t(()=>[i("div",ee,[i("h2",te,n(s.topic.title),1),i("div",oe,[o(E,{type:p.getStatusType(s.topic.status),size:"large"},{default:t(()=>[u(n(s.topic.status),1)]),_:1},8,["type"])])])]),default:t(()=>[o(v,{gutter:30},{default:t(()=>[o(d,{span:16},{default:t(()=>[o(w,{column:2,border:"",class:"topic-info"},{default:t(()=>[o(r,{label:"选题分类"},{default:t(()=>[o(E,{type:"primary"},{default:t(()=>[u(n(s.topic.category),1)]),_:1})]),_:1}),o(r,{label:"提交时间"},{default:t(()=>[u(n(s.topic.submitTime),1)]),_:1}),o(r,{label:"学生ID"},{default:t(()=>[u(n(s.topic.studentId),1)]),_:1}),o(r,{label:"更新时间"},{default:t(()=>[u(n(s.topic.updateTime),1)]),_:1}),o(r,{label:"关键词"},{default:t(()=>[u(n(s.topic.keywords),1)]),_:1}),o(r,{label:"状态"},{default:t(()=>[o(E,{type:p.getStatusType(s.topic.status)},{default:t(()=>[u(n(s.topic.status),1)]),_:1},8,["type"])]),_:1}),o(r,{label:"选题描述",span:2},{default:t(()=>[i("p",se,n(s.topic.description),1)]),_:1}),o(r,{label:"项目背景",span:2},{default:t(()=>[i("p",ie,n(s.topic.background),1)]),_:1}),o(r,{label:"项目目标",span:2},{default:t(()=>[i("p",le,n(s.topic.objectives),1)]),_:1}),o(r,{label:"研究方法",span:2},{default:t(()=>[i("p",ae,n(s.topic.methodology),1)]),_:1}),o(r,{label:"预期成果",span:2},{default:t(()=>[i("p",ne,n(s.topic.expectedResults),1)]),_:1})]),_:1})]),_:1}),o(d,{span:8},{default:t(()=>[i("div",re,[e[12]||(e[12]=i("h3",null,"评价信息",-1)),s.averageScore>0?(c(),m("div",ce,[i("div",ue,[i("div",de,n(s.averageScore),1),e[7]||(e[7]=i("div",{class:"score-label"},"平均分",-1))])])):_("",!0),s.evaluations.length>0?(c(),m("div",pe,[o(x,null,{default:t(()=>[(c(!0),m(V,null,F(s.evaluations,l=>(c(),b(C,{key:l.id,timestamp:l.evaluationTime,placement:"top"},{default:t(()=>[o(h,null,{default:t(()=>[i("div",me,[i("div",_e,[i("strong",null,"评价教师："+n(l.evaluatorName||"教师"+l.evaluatorId),1)]),i("div",fe,[o(v,{gutter:10},{default:t(()=>[o(d,{span:8},{default:t(()=>[i("div",ge,[e[8]||(e[8]=i("span",{class:"score-label"},"创新性",-1)),i("span",ve,n(l.innovationScore)+"/5",1)])]),_:2},1024),o(d,{span:8},{default:t(()=>[i("div",he,[e[9]||(e[9]=i("span",{class:"score-label"},"可行性",-1)),i("span",ye,n(l.feasibilityScore)+"/5",1)])]),_:2},1024),o(d,{span:8},{default:t(()=>[i("div",be,[e[10]||(e[10]=i("span",{class:"score-label"},"意义性",-1)),i("span",Ee,n(l.significanceScore)+"/5",1)])]),_:2},1024)]),_:2},1024)]),i("div",Se," 总分："+n(l.totalScore)+"/15 ",1),l.suggestions?(c(),m("div",ke,[e[11]||(e[11]=i("p",null,[i("strong",null,"修改建议：")],-1)),i("p",null,n(l.suggestions),1)])):_("",!0)])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(c(),b(I,{key:2,description:"暂无评价信息","image-size":100}))]),s.canEvaluate?(c(),m("div",Ve,[o(g,{type:"primary",onClick:p.showEvaluationDialog,icon:a.Edit},{default:t(()=>e[13]||(e[13]=[u(" 提交评价 ")])),_:1},8,["onClick","icon"])])):_("",!0)]),_:1})]),_:1})]),_:1}),s.recommendTopics.length>0?(c(),b(h,{key:0,class:"recommend-card"},{header:t(()=>e[14]||(e[14]=[i("h3",null,"相关推荐",-1)])),default:t(()=>[o(v,{gutter:20},{default:t(()=>[(c(!0),m(V,null,F(s.recommendTopics,l=>(c(),b(d,{span:8,key:l.id},{default:t(()=>[o(h,{class:"recommend-item",onClick:Te=>p.viewRecommend(l)},{default:t(()=>[i("div",Fe,n(l.title),1),i("div",we,[i("span",null,n(l.category),1),i("span",null,n(l.status),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})):_("",!0),o(R,{modelValue:s.evaluationVisible,"onUpdate:modelValue":e[5]||(e[5]=l=>s.evaluationVisible=l),title:"选题评价",width:"60%","before-close":p.handleEvaluationClose},{footer:t(()=>[i("span",Ce,[o(g,{onClick:e[4]||(e[4]=l=>s.evaluationVisible=!1)},{default:t(()=>e[15]||(e[15]=[u("取消")])),_:1}),o(g,{type:"primary",onClick:p.submitEvaluation,loading:s.loading},{default:t(()=>e[16]||(e[16]=[u(" 提交评价 ")])),_:1},8,["onClick","loading"])])]),default:t(()=>[o(D,{model:s.evaluationForm,rules:s.evaluationRules,ref:"evaluationFormRef","label-width":"100px"},{default:t(()=>[o(v,{gutter:20},{default:t(()=>[o(d,{span:8},{default:t(()=>[o(y,{label:"创新性评分",prop:"innovationScore"},{default:t(()=>[o(S,{modelValue:s.evaluationForm.innovationScore,"onUpdate:modelValue":e[0]||(e[0]=l=>s.evaluationForm.innovationScore=l),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{span:8},{default:t(()=>[o(y,{label:"可行性评分",prop:"feasibilityScore"},{default:t(()=>[o(S,{modelValue:s.evaluationForm.feasibilityScore,"onUpdate:modelValue":e[1]||(e[1]=l=>s.evaluationForm.feasibilityScore=l),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1}),o(d,{span:8},{default:t(()=>[o(y,{label:"意义性评分",prop:"significanceScore"},{default:t(()=>[o(S,{modelValue:s.evaluationForm.significanceScore,"onUpdate:modelValue":e[2]||(e[2]=l=>s.evaluationForm.significanceScore=l),max:5,"show-score":"","score-template":"{value}分"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(y,{label:"修改建议",prop:"suggestions"},{default:t(()=>[o(T,{modelValue:s.evaluationForm.suggestions,"onUpdate:modelValue":e[3]||(e[3]=l=>s.evaluationForm.suggestions=l),type:"textarea",rows:4,placeholder:"请输入修改建议..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"])])):_("",!0)}const Ge=B(Y,[["render",xe],["__scopeId","data-v-b7a96588"]]);export{Ge as default};
