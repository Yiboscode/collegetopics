/* empty css                *//* empty css               *//* empty css                *//* empty css               *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                *//* empty css               *//* empty css              *//* empty css             */import{r as h}from"./request-CfAbx4ue.js";/* empty css                    */import{_ as F,ak as U,al as j,am as I,an as P,c as w,a as t,ao as R,b as a,w as l,ad as K,ap as q,z as G,A as H,aq as J,m as N,C as O,D as Q,E as f,N as x,B as W,h as v,o as _,t as n,k as X,j as r,G as Y,P as Z,n as z,F as $,x as ee,af as te}from"./index-BlySnbrc.js";const ae={name:"TeamManage",components:{UserFilled:P,Avatar:I,Bell:j,Check:U},data(){return{loading:!1,teamList:[],searchForm:{teamName:""},pagination:{page:1,size:10,total:0},teamStats:{totalTeams:0,totalMembers:0,pendingApplications:0,fullTeams:0},showDetailDialog:!1,showMembersDialog:!1,selectedTeam:null,teamMembers:[],teamApplications:[]}},mounted(){this.loadData()},methods:{async loadData(){await this.loadTeamList(),await this.loadStats()},async loadTeamList(){this.loading=!0;try{const i=await h.get("/team/selectAll",{params:{teamName:this.searchForm.teamName}});this.teamList=i.data||[],this.pagination.total=this.teamList.length}catch(i){console.error("加载团队列表失败:",i),f.error("加载团队列表失败")}finally{this.loading=!1}},async loadStats(){var i;try{const e=this.teamList.length;let T=0,y=0;for(const C of this.teamList){const u=C.memberCount||0;T+=u,u>=7&&y++}const m=((i=(await h.get("/teamApplication/selectAll",{params:{status:"pending"}})).data)==null?void 0:i.length)||0;this.teamStats={totalTeams:e,totalMembers:T,pendingApplications:m,fullTeams:y}}catch(e){console.error("加载统计数据失败:",e)}},async showTeamDetail(i){this.selectedTeam=i,await Promise.all([this.loadTeamMembers(i.id),this.loadTeamApplications(i.id)]),this.showDetailDialog=!0},async loadTeamMembers(i){try{const e=await h.get(`/teamMember/selectByTeamId/${i}`);this.teamMembers=e.data||[]}catch(e){console.error("加载团队成员失败:",e)}},async loadTeamApplications(i){try{const e=await h.get(`/teamApplication/selectByTeamId/${i}`);this.teamApplications=e.data||[]}catch(e){console.error("加载团队申请失败:",e)}},async manageMembers(i){this.selectedTeam=i,await this.loadTeamMembers(i.id),this.showMembersDialog=!0},async removeMember(i){try{await x.confirm(`确定要移除成员 ${i.studentName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(`/teamMember/delete/${i.id}`),f.success("移除成员成功"),await this.loadTeamMembers(this.selectedTeam.id),await this.loadTeamList()}catch(e){e!=="cancel"&&f.error(e.message||"移除成员失败")}},async deleteTeam(i){try{await x.confirm(`确定要删除团队 ${i.teamName} 吗？此操作不可恢复！`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(`/team/delete/${i.id}`),f.success("删除团队成功"),await this.loadData()}catch(e){e!=="cancel"&&f.error(e.message||"删除团队失败")}},resetSearch(){this.searchForm.teamName="",this.loadTeamList()},refreshData(){this.loadData()},exportTeamData(){f.info("导出功能开发中...")},handleSizeChange(i){this.pagination.size=i,this.loadTeamList()},handleCurrentChange(i){this.pagination.page=i,this.loadTeamList()},getStatusType(i){return{pending:"warning",approved:"success",rejected:"danger"}[i]||"info"},getStatusText(i){return{pending:"待审核",approved:"已同意",rejected:"已拒绝"}[i]||i}}},se={class:"team-manage"},le={class:"stats-cards"},ie={class:"stat-content"},oe={class:"stat-number"},ne={class:"stat-icon"},re={class:"stat-content"},de={class:"stat-number"},me={class:"stat-icon"},ce={class:"stat-content"},pe={class:"stat-number"},ue={class:"stat-icon"},_e={class:"stat-content"},ge={class:"stat-number"},he={class:"stat-icon"},fe={class:"toolbar"},we={class:"search-section"},be={class:"action-section"},ve={class:"pagination"},Te={key:0,class:"team-detail"},ye={class:"detail-grid"},Ce={class:"detail-item"},ke={class:"detail-item"},ze={class:"detail-item"},Me={class:"detail-item"},De={class:"detail-item"},Ne={class:"detail-item"},xe={class:"members-section"},Se={class:"members-list"},Ae={class:"member-info"},Be={class:"member-name"},Le={class:"member-role"},Ee={class:"member-time"},Ve={class:"applications-section"},Fe={key:0},Ue={class:"members-header"};function je(i,e,T,y,o,m){const C=v("UserFilled"),u=X,b=K,S=v("Avatar"),A=v("Bell"),B=v("Check"),L=G,c=H,d=Y,g=Z,k=W,E=O,M=te,D=Q,V=J;return _(),w("div",se,[e[28]||(e[28]=t("div",{class:"header"},[t("h2",null,"团队管理"),t("p",null,"管理系统中的所有团队信息")],-1)),t("div",le,[a(b,{class:"stat-card"},{default:l(()=>[t("div",ie,[t("div",oe,n(o.teamStats.totalTeams),1),e[6]||(e[6]=t("div",{class:"stat-label"},"总团队数",-1))]),t("div",ne,[a(u,{size:"40"},{default:l(()=>[a(C)]),_:1})])]),_:1}),a(b,{class:"stat-card"},{default:l(()=>[t("div",re,[t("div",de,n(o.teamStats.totalMembers),1),e[7]||(e[7]=t("div",{class:"stat-label"},"总成员数",-1))]),t("div",me,[a(u,{size:"40"},{default:l(()=>[a(S)]),_:1})])]),_:1}),a(b,{class:"stat-card"},{default:l(()=>[t("div",ce,[t("div",pe,n(o.teamStats.pendingApplications),1),e[8]||(e[8]=t("div",{class:"stat-label"},"待处理申请",-1))]),t("div",ue,[a(u,{size:"40"},{default:l(()=>[a(A)]),_:1})])]),_:1}),a(b,{class:"stat-card"},{default:l(()=>[t("div",_e,[t("div",ge,n(o.teamStats.fullTeams),1),e[9]||(e[9]=t("div",{class:"stat-label"},"满员团队",-1))]),t("div",he,[a(u,{size:"40"},{default:l(()=>[a(B)]),_:1})])]),_:1})]),t("div",fe,[t("div",we,[a(L,{modelValue:o.searchForm.teamName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.searchForm.teamName=s),placeholder:"搜索团队名称",style:{width:"300px"},onKeyup:q(m.loadTeamList,["enter"])},{prepend:l(()=>e[10]||(e[10]=[r("团队名称")])),_:1},8,["modelValue","onKeyup"]),a(c,{type:"primary",onClick:m.loadTeamList,icon:"Search"},{default:l(()=>e[11]||(e[11]=[r("搜索")])),_:1},8,["onClick"]),a(c,{onClick:m.resetSearch,icon:"Refresh"},{default:l(()=>e[12]||(e[12]=[r("重置")])),_:1},8,["onClick"])]),t("div",be,[a(c,{type:"success",onClick:m.exportTeamData,icon:"Download"},{default:l(()=>e[13]||(e[13]=[r("导出数据")])),_:1},8,["onClick"]),a(c,{type:"info",onClick:m.refreshData,icon:"Refresh"},{default:l(()=>e[14]||(e[14]=[r("刷新")])),_:1},8,["onClick"])])]),R((_(),N(k,{data:o.teamList,style:{width:"100%"}},{default:l(()=>[a(d,{prop:"id",label:"ID",width:"80",align:"center"}),a(d,{prop:"teamName",label:"团队名称","min-width":"150"},{default:l(s=>[a(c,{type:"link",onClick:p=>m.showTeamDetail(s.row)},{default:l(()=>[r(n(s.row.teamName),1)]),_:2},1032,["onClick"])]),_:1}),a(d,{prop:"topicTitle",label:"选题","min-width":"200","show-overflow-tooltip":""}),a(d,{prop:"leaderName",label:"队长",width:"120"}),a(d,{label:"成员数量",width:"100",align:"center"},{default:l(s=>[a(g,{type:s.row.memberCount>=7?"success":"warning"},{default:l(()=>[r(n(s.row.memberCount||0)+"/7 ",1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(s=>[a(g,{type:s.row.memberCount>=7?"info":"success"},{default:l(()=>[r(n(s.row.memberCount>=7?"已满员":"招募中"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"createTime",label:"创建时间",width:"160"}),a(d,{label:"操作",width:"200",align:"center",fixed:"right"},{default:l(s=>[a(c,{type:"primary",size:"small",onClick:p=>m.showTeamDetail(s.row)},{default:l(()=>e[15]||(e[15]=[r("详情")])),_:2},1032,["onClick"]),a(c,{type:"warning",size:"small",onClick:p=>m.manageMembers(s.row)},{default:l(()=>e[16]||(e[16]=[r("成员")])),_:2},1032,["onClick"]),a(c,{type:"danger",size:"small",onClick:p=>m.deleteTeam(s.row)},{default:l(()=>e[17]||(e[17]=[r("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[V,o.loading]]),t("div",ve,[a(E,{"current-page":o.pagination.page,"onUpdate:currentPage":e[1]||(e[1]=s=>o.pagination.page=s),"page-size":o.pagination.size,"onUpdate:pageSize":e[2]||(e[2]=s=>o.pagination.size=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:o.pagination.total,onSizeChange:m.handleSizeChange,onCurrentChange:m.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),a(D,{modelValue:o.showDetailDialog,"onUpdate:modelValue":e[3]||(e[3]=s=>o.showDetailDialog=s),title:"团队详情",width:"800px"},{default:l(()=>[o.selectedTeam?(_(),w("div",Te,[t("div",ye,[t("div",Ce,[e[18]||(e[18]=t("label",null,"团队名称：",-1)),t("span",null,n(o.selectedTeam.teamName),1)]),t("div",ke,[e[19]||(e[19]=t("label",null,"选题：",-1)),t("span",null,n(o.selectedTeam.topicTitle),1)]),t("div",ze,[e[20]||(e[20]=t("label",null,"队长：",-1)),t("span",null,n(o.selectedTeam.leaderName),1)]),t("div",Me,[e[21]||(e[21]=t("label",null,"成员数量：",-1)),t("span",null,n(o.selectedTeam.memberCount||0)+"/7人",1)]),t("div",De,[e[22]||(e[22]=t("label",null,"状态：",-1)),a(g,{type:o.selectedTeam.memberCount>=7?"info":"success"},{default:l(()=>[r(n(o.selectedTeam.memberCount>=7?"已满员":"招募中"),1)]),_:1},8,["type"])]),t("div",Ne,[e[23]||(e[23]=t("label",null,"创建时间：",-1)),t("span",null,n(o.selectedTeam.createTime),1)])]),t("div",xe,[e[24]||(e[24]=t("h4",null,"团队成员",-1)),t("div",Se,[(_(!0),w($,null,ee(o.teamMembers,s=>(_(),w("div",{key:s.id,class:"member-card"},[a(M,{src:s.avatar,size:50},{default:l(()=>{var p;return[r(n((p=s.studentName)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"]),t("div",Ae,[t("div",Be,n(s.studentName),1),t("div",Le,[a(g,{type:s.role==="队长"?"warning":"info",size:"small"},{default:l(()=>[r(n(s.role),1)]),_:2},1032,["type"])]),t("div",Ee,"加入时间："+n(s.joinTime),1)])]))),128))])]),t("div",Ve,[e[25]||(e[25]=t("h4",null,"申请记录",-1)),a(k,{data:o.teamApplications,size:"small"},{default:l(()=>[a(d,{prop:"applicantName",label:"申请人",width:"100"}),a(d,{prop:"message",label:"申请留言","show-overflow-tooltip":""}),a(d,{prop:"applyTime",label:"申请时间",width:"160"}),a(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(s=>[a(g,{type:m.getStatusType(s.row.status),size:"small"},{default:l(()=>[r(n(m.getStatusText(s.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"handleTime",label:"处理时间",width:"160"})]),_:1},8,["data"])])])):z("",!0)]),_:1},8,["modelValue"]),a(D,{modelValue:o.showMembersDialog,"onUpdate:modelValue":e[5]||(e[5]=s=>o.showMembersDialog=s),title:"成员管理",width:"600px"},{default:l(()=>[o.selectedTeam?(_(),w("div",Fe,[t("div",Ue,[t("h4",null,n(o.selectedTeam.teamName)+" - 成员管理",1),a(c,{type:"primary",size:"small",onClick:e[4]||(e[4]=s=>m.loadTeamMembers(o.selectedTeam.id))},{default:l(()=>e[26]||(e[26]=[r("刷新")])),_:1})]),a(k,{data:o.teamMembers,size:"small"},{default:l(()=>[a(d,{label:"头像",width:"80",align:"center"},{default:l(s=>[a(M,{src:s.row.avatar,size:40},{default:l(()=>{var p;return[r(n((p=s.row.studentName)==null?void 0:p.charAt(0)),1)]}),_:2},1032,["src"])]),_:1}),a(d,{prop:"studentName",label:"姓名"}),a(d,{prop:"role",label:"角色",width:"100",align:"center"},{default:l(s=>[a(g,{type:s.row.role==="队长"?"warning":"info",size:"small"},{default:l(()=>[r(n(s.row.role),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"joinTime",label:"加入时间",width:"160"}),a(d,{label:"操作",width:"120",align:"center"},{default:l(s=>[s.row.role!=="队长"?(_(),N(c,{key:0,type:"danger",size:"small",onClick:p=>m.removeMember(s.row)},{default:l(()=>e[27]||(e[27]=[r(" 移除 ")])),_:2},1032,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"])])):z("",!0)]),_:1},8,["modelValue"])])}const tt=F(ae,[["render",je],["__scopeId","data-v-bc178516"]]);export{tt as default};
